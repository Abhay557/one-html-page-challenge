<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/fontawesome.min.css" integrity="sha384-wESLQ85D6gbsF459vf1CiZ2+rr+CsxRY0RpiF1tLlQpDnAgg6rwdsUF1+Ics2bni" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <title>Task List
  </title>
</head>
<body>
  <nav>
    <div class="nav-wrapper blue">
      <a href="#" class="brand-logo center">To do List</a>
    </div>
  </nav>
  <div class="container">
    <div class="row">
      <div class="col s12">
        <div id="main" class="card">
          <div class="card-content">
            <!-- <h3 class="card-title">Tasks</h3> -->
            <div class="row">
              <form id="task-form">
                <div class="input-field">
                <input type="text" id="task" name="task">
                <label for="text" >New Task</label>
              </div>
              <input type="submit" class="btn" value="Add Task">
              </form>
            </div>

            </div>
            <div class="card-action">
              <h5 class="task-title">Tasks</h5>
              <div class="input-field">
                <input type="text" id="filter" name="filter">
                <label for="filter" >Filter Task</label>
              </div>
              <ul class="collection"></ul>
            <a href="#" class="clear-tasks btn black">Clear Tasks</a>
            </div>
            
          </div>
      </div>
    </div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
  <script>
        //Define UI varibale

    const form = document.querySelector('#task-form');
    const taskList = document.querySelector('.collection');
    const clearBtn = document.querySelector('.clear-tasks');
    const filter = document.querySelector('#filter');
    const taskInput = document.querySelector('#task');

    //load all event listeners

    loadEventListeners();

    function loadEventListeners(){
      //DOM load event
      document.addEventListener('DOMContentLoaded', getTasks);
      //Add task event
      form.addEventListener('submit',addTask);
      //remove task list
      taskList.addEventListener('click',removeTask);
      //clear all task
      clearBtn.addEventListener('click',clearAll);
      //filter task
      filter.addEventListener('keyup',filterTasks);
    }
    //get tasks from local storage
    function getTasks(){
      let tasks;
      if(localStorage.getItem('tasks') === null){
        tasks = [];
      }else{
        tasks = JSON.parse(localStorage.getItem('tasks'));
      }
      // console.log(tasks);
      // console.log('helllo');

      tasks.forEach(function(task){
        //create li element
      const li = document.createElement('li');
      //add class
      li.className = 'collection-item';
      //add text node and append
      li.appendChild(document.createTextNode(task));
      //add cross link 
      const link = document.createElement('a');
      //add class
      link.className = 'delete-item secondary-content';
      //add inner html
      link.innerHTML = '<i class="fa fa-remove"></i>';
      //append to li
      li.appendChild(link);
      //append li as child to ul
      taskList.appendChild(li);
      // console.log(li);

      })

    }

    //add task
    function addTask(e){
      if(taskInput.value === ''){
        alert('Please enter a value');
      }

      //create li element
      const li = document.createElement('li');
      //add class
      li.className = 'collection-item';
      //add text node and append
      li.appendChild(document.createTextNode(taskInput.value));
      //add cross link 
      const link = document.createElement('a');
      //add class
      link.className = 'delete-item secondary-content';
      //add inner html
      link.innerHTML = '<i class="fa fa-remove"></i>';
      //append to li
      li.appendChild(link);
      //append li as child to ul
      taskList.appendChild(li);

      //Store in local storage
      storeInLocalStorage(taskInput.value);
      //clear input
      taskInput.value = '';


      //PREVENT default
      e.preventDefault();
    }

    //store in local storage
    function storeInLocalStorage(task){
      let tasks;
      if(localStorage.getItem('tasks') === null){
        tasks = [];
      }else{
        tasks = JSON.parse(localStorage.getItem('tasks'));
      }
      tasks.push(task);
      localStorage.setItem('tasks',JSON.stringify(tasks));
    }
    //-------------------------------

    //--------------------------------

    //Remove task
    function removeTask(e){
      if(e.target.parentElement.classList.contains('delete-item')){
        if(confirm('Are you sure?')){
        e.target.parentElement.parentElement.remove();
        //remove from local storage
        removeTaskFromLocalStorage(e.target.parentElement.parentElement);
        }
      }
    }

    //remove from local storage
    function removeTaskFromLocalStorage(taskItem){
      // console.log(taskItem);
      let tasks;
      if(localStorage.getItem('tasks') === null){
        tasks = [];
      }else{
        tasks = JSON.parse(localStorage.getItem('tasks'));
      }
      // console.log(tasks);

      tasks.forEach(function(task,index){
        if(taskItem.textContent === task){
          tasks.splice(index,1);
        }
      });

      localStorage.setItem('tasks', JSON.stringify(tasks));

    }
    //clear all
    function clearAll(e){
      // taskList.innerHTML = ''; //slower way

      //faster way
      while(taskList.firstChild){
        taskList.removeChild(taskList.firstChild);
      }
      
      //clear from LS
      clearFromLocalStorage();
    }

    //Clear from Local Storage
    function clearFromLocalStorage(){
      localStorage.clear();
    }

    //filter taks
    function filterTasks(e){
      const text = e.target.value.toLowerCase();
      
      document.querySelectorAll('.collection-item').forEach(function(task){
        const item = task.firstChild.textContent;
        if(item.toLowerCase().indexOf(text) != -1 ){
          task.style.display = 'block';
        }else
        task.style.display = 'none';

      });


    }
  </script>
</body>
</html>